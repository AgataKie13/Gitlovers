---
title: "PCMarkdown"
author: "Patrycja Cebulska"
date: "2024-11-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = FALSE, include = FALSE)
```

## 1. Macierz korelacji

```{r}
dane2 <- read.csv("Hipoteczny.csv")
```

## a) Przekodowanie zmiennych

Na początek zmienne kategoryczne zostają przekodowane na zmienne numeryczne, aby możliwe było zbadanie koralecji pomiędzy poszczególnymi zmiennymi.

```{r}
dane2$Gender <- ifelse(!is.na(dane2$Gender) & dane2$Gender == "Male", 1, 
                       ifelse(!is.na(dane2$Gender), 0, NA))

dane2$Married <- ifelse(!is.na(dane2$Married) & dane2$Married == "Yes", 1, 
                        ifelse(!is.na(dane2$Married), 0, NA))

dane2$Self_Employed <- ifelse(!is.na(dane2$Self_Employed) & dane2$Self_Employed == "Yes", 1, 
                              ifelse(!is.na(dane2$Self_Employed), 0, NA))

dane2$Education <- ifelse(!is.na(dane2$Education) & dane2$Education == "Graduate", 1, 
                          ifelse(!is.na(dane2$Education), 0, NA))

dane2$Property_Area <- factor(dane2$Property_Area, levels = c("Rural", "Semiurban", "Urban"))
dane2$Property_Area <- as.numeric(dane2$Property_Area)
dane2$Property_Area[is.na(dane2$Property_Area)] <- NA

dane2$Dependents <- ifelse(!is.na(dane2$Dependents) & dane2$Dependents == "3+", 3, 
                           ifelse(!is.na(dane2$Dependents), as.numeric(dane2$Dependents), NA))
```

**opis przekształceń poszczególnych zmiennych kategorycznych do postaci numerycznej**

**Gender:** Zmienna Gender zawiera informacje o płci, "Male" jest kodowana jako 1, a "Female" 0.

**Married:** Zmienna Married jest przekodowywana, aby 1 oznaczało "Yes",a 0 "No".

**Self_Employed:** Zmienna Self_Employed jest przekodowywana na 1 dla odpowiedzi "Yes", a 0 dla "No".

**Education:** Wartości "Graduate" są kodowane jako 1, a "Not Graduate" jako 0

**Property_Area:** Zmienna Property_Area zawiera trzy kategorie: "Rural", "Semiurban", "Urban". Zostały im przypisane kolejno liczby: 1, 2 i 3.

**Dependents:** Zmienna Dependents zawiera liczbę osób na utrzymaniu, wartość "3+" jest zamieniana na 3, a pozostałe wartości są przekodowane na liczby.

Następnie sprawdzamy jak wyglądają zmienne po przekodowaniu.

```{r}
head(dane2)
```

Zmieniamy zmienne po przekodowaniu na numeryczne.

```{r}
numeric_dane2 <- dane2[, sapply(dane2, is.numeric)]
```

## b) Macierz korelacji poszczególnych zmiennych

Następnie tworzymy macierz korelacji wszystkich zmiennych.

```{r}
correlation_dane2 <- cor(numeric_dane2, use = "complete.obs")
library(knitr)
kable(correlation_dane2, format = "markdown")
```

Macierz korelacji przedstawia zależności pomiędzy wszystkimi zmiennymi, umożliwiając wstępną ocenę, które zmienne i w jakim stopniu są ze sobą skorelowane.

## c) Macierz korelacji braków danych

Tworzymy macierz korelacji pomiędzy brakującymi zmiennymi, aby ocenić czy występują jakieś zależności w brakach danych.

Tworzymy nowe zmienne flagujące braki danych 1 = brak danych, 0 = nie występuje brak danych.

```{r}

library(dplyr)

dane2 <- dane2 %>%
  mutate(
    flag_LoanAmount = ifelse(is.na(LoanAmount), 1, 0),
    flag_ApplicantIncome = ifelse(is.na(ApplicantIncome), 1, 0),
    flag_CoapplicantIncome = ifelse(is.na(CoapplicantIncome), 1, 0), 
    flag_Credit_History = ifelse(is.na(Credit_History), 1, 0),
    flag_Gender = ifelse(is.na(Gender), 1, 0),
    flag_Married = ifelse(is.na(Married), 1, 0),
    flag_Dependents = ifelse(is.na(Dependents), 1, 0),
    flag_Education = ifelse(is.na(Education), 1, 0),
    flag_Self_Employed = ifelse(is.na(Self_Employed), 1, 0),
    flag_Loan_Amount_Term = ifelse(is.na(Loan_Amount_Term), 1, 0),
    flag_Property_Area = ifelse(is.na(Property_Area), 1, 0)
  )
```

Sprawdzamy, czy nowe zmienne zostały dodane.

```{r}
head(dane2)
```

Tworzymy macierz korelacji wybierając jedynie zmienne flagowe, określające istnienie braku danych.

```{r}
flags <- dane2 %>%
  select(flag_LoanAmount, flag_ApplicantIncome, flag_CoapplicantIncome, flag_Credit_History,
         flag_Gender, flag_Married, flag_Dependents, flag_Education, flag_Self_Employed,
         flag_Loan_Amount_Term, flag_Property_Area)

corr_flags <- cor(flags, use = "complete.obs")

kable(corr_flags, format = "markdown")

```

Otwrzymujemy macierz przedstawiającą korelację pomiędzy brakami danych, co pozwala nam na określenie czy występuje zależność pomiędzy brakiem odpowiedzi na poszczególne pytania.

## d) Macierz korelacji pomiędzy zmiennymi, a występowaniem braku danych

Trzecią macierzą, którą tworzymy jest macierz określająca zależność pomiędzy flagowymi zmiennymi informującymi o tym czy istnieje brak danych, a wszyskimi innymi zmiennymi.

```{r}
dane2 <- dane2 %>%
  select(
    LoanAmount, ApplicantIncome, CoapplicantIncome, Loan_Amount_Term, Credit_History,
    Gender, Married, Education, Self_Employed, Property_Area,
    flag_LoanAmount, flag_ApplicantIncome, flag_CoapplicantIncome, flag_Loan_Amount_Term,
    flag_Credit_History, flag_Gender, flag_Married, flag_Dependents, flag_Education,
    flag_Self_Employed, flag_Property_Area
  )


corr_dane2_flags <- cor(dane2, use = "complete.obs")

kable(corr_dane2_flags, format = "markdown")
```

......
